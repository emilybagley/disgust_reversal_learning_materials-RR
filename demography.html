<!DOCTYPE html>
<html>
  <head>
    <title>Questionnaires</title>
    <script src="https://unpkg.com/jspsych@7.3.3"></script>
    <script src="jatos.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-button-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-call-function@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey@0.2.0"></script>
    <link rel="stylesheet" href="https://unpkg.com/@jspsych/plugin-survey@0.2.0/css/survey.css">
    <script type="text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>

  <style>
  </style>
  </head>
  <body></body>
  <script>

  //initiliase jsPsych  and preload stimuli
      var jsPsych = initJsPsych({
          on_trial_start: jatos.addAbortButton,
          on_finish: function(){
            //jatos.startNextComponent(jsPsych.data.get().json())
            window.onbeforeunload = null;
            let trialsJson = jsPsych.data.get().json();
            jatos.submitResultData(trialsJson, jatos.startNextComponent);
            jatos.endStudyAndRedirect("https://app.prolific.com/submissions/complete?cc=C1HGSBS1")
          },
         /* on_finish: function() {
              jsPsych.data.displayData();} //allows you to view data at the end of the experiment - useful for testing the task*/
      });

      timeline=[];

      var demography = {
        type: jsPsychSurvey,
        pages: [
          [
          {type: "html",
          prompt: `<b>Demographic questions</b>`,
          name: "title"},
          {type: "drop-down",
          name: "gender",
          prompt: 'What is your gender?',
          options: ['Male', 'Female', 'Non binary', 'Other', 'Prefer not to say'],
          required: true},
          {type: "drop-down",
          name: "assigned-at-birth",
          prompt: "Is this gender the same as your sex assigned at birth?",
          options: ['Yes', 'No'],
          required: true},
          {type: "text",
          prompt: "How old are you?",
          name: "age",
          required: true
          },
            {type: "text",
            prompt: `This is a new experiment which we are trialing. Please write any feedback you have for us in the box.`,
            textbox_rows: 7,
            name: "feedback"
            }],
        [
            {type: "html",
            prompt: `<p><b>That's it!</b><p>
            <p>Thank you so much for taking part in our study.</p>
            <p><b> Press 'Finish' to end the experiment </b>`,
            name: "final_goodbye"}
        ]
        ],
        on_finish: function(data){
            data.trial_var="demography"}
      }
      timeline.push(demography)


// start the experiment
      /* start the experiment */
      jatos.onLoad(() => {
        prolific_id = jatos.urlQueryParameters.PROLIFIC_PID;
        study_id = jatos.urlQueryParameters.STUDY_ID;
        session_id = jatos.urlQueryParameters.SESSION_ID;
        jsPsych.data.addProperties({prolific_id: prolific_id, study_id: study_id, session_id: session_id})
        jsPsych.run(timeline);
      });
  </script>
</html>